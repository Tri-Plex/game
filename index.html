<!DOCTYPE html>
<title>temp</title>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<p>\/ :O Look there is stuff here! :D \/</p>
	<style>
		* {
			padding: 0;
			margin: 0;
		}

		canvas {
			background: #eee;
			display: block;
			margin: 0 auto;
		}
	</style>
</head>

<div style="display:none;">
</div>

<body>
	<h1 id="coords"></h1>
	<p id="log"></p>
	<canvas id="myCanvas" width="1080" height="980"></canvas>
	<script>
        window.onerror = function (msg, url, num) {
    alert("Error: " + msg + "\nURL: " + url + "\nLine: " + num);
    return true;
};

		var canvas = document.getElementById("myCanvas");
		var ctx = canvas.getContext("2d");
		canvas.height = window.innerHeight;
		canvas.width = window.innerWidth;

		//image stuff
		const images = {};
		images.meadow = new Image();
		images.meadow.src= "Images/Meadow.png";
		images.player = new Image();
		images.player.src = "Images/CharacterSpriteSheet.png";

		const playerWidth = '180';
		const playerHeight = '341.25';
		var tiles = [[1,1,1,1,1,1],
					[1,1,1,1,1,1],
					[1,1,1,1,1,1],
					[1,1,1,1,1,1]];
        //type,posx,posy,width,height
        var obj = [[1,0,0,50,50]];
        let ai = [[1,Math.random()*1000,Math.random()*1000]];
		var pressedKeys = {};
        
		let playerFrameX = 0;
		let playerFrameY = 0;
		let playerX = 0;
		let playerY = 0;
		const playerSpeed = 6;
		var motion = false;
		var animationSpeed=150;

		function drawSprite(img, sX, sY, sW, sH, dX, dY, dW, dH) {
			ctx.drawImage(img, sX, sY, sW, sH, dX, dY, dW, dH);
		}

		function draw() {

			keyLogic();
            
			ctx.clearRect(0, 0, canvas.width, canvas.height);
            
			for(var i =0; i<tiles.length;i++){
				for(var j = 0;j<tiles[i].length;j++){
				if(tiles[i][j] == 1){
					drawSprite(images.meadow,0,0,640,640,playerX+(320*j),playerY+(320*i),640/2,640/2);
				}
			}
			}
            ctx.beginPath();
            for(var i = 0;i<obj.length;i++){
                if(obj[i][0] ==1){
                    ctx.fillStyle = "red";
			        ctx.fill();
                    ctx.rect(obj[i][1]+playerX,obj[i][2]+playerY,obj[i][3],obj[i][4]);
                   }
            }
            ctx.stroke();
			drawSprite(images.player, playerWidth * playerFrameX, playerHeight * playerFrameY, playerWidth, playerHeight, canvas.width/2-(playerWidth/2),                         canvas.height/2-(playerHeight/2), playerWidth/2, playerHeight/2);
            
			

		}
		function animate() {
			if (motion == true) {
				if (playerFrameX < 5) {
					playerFrameX++;
				}
				else {
					playerFrameX = 0;
				}
			}
			else{
				playerFrameX= false;
			}
		}
        
        function collisionCheck(){
            for(var i = 0;i<obj.length;i++){
                    if(obj[i][0] ==1){
                        if((obj[i][1]+playerX) >= canvas.width/2-20||(obj[i][1]+obj[i][3]+playerX) <= canvas.width/2-(playerWidth/2-20)){
                       return false;
                    }
                        else if(obj[i][2]+playerY >= canvas.height/2 || obj[i][2]+obj[i][4]+playerY <= canvas.height/2-(playerHeight/2-120)){
                            return false;
                        }
            
            }
        }
            return true;
        }
        
		function keyLogic() {
			if (pressedKeys["KeyW"]) {
				motion = true;
				if (pressedKeys["KeyA"]) {
					playerFrameY = 7;
					playerX += Math.sqrt(2)/2;
					playerY += Math.sqrt(2)/2;
                    if(collisionCheck()){
                      playerX -= Math.sqrt(2)/2;
					playerY -= Math.sqrt(2)/2;  
                    }
				}
				else if (pressedKeys["KeyD"]) {
					playerFrameY = 6;
					playerX -= Math.sqrt(2)/2;
					playerY += Math.sqrt(2)/2;
                    if(collisionCheck()){
                      playerX += Math.sqrt(2)/2;
					playerY -= Math.sqrt(2)/2;  
                    }
                   
                }
				else {
					playerFrameY = 1;
					playerY += 1;
                    if(collisionCheck()){
                      
					playerY -= 1;  
                    }
                    
			}
                }
			else if (pressedKeys["KeyS"]) {
				motion = true;
				if (pressedKeys["KeyA"]) {
					playerFrameY = 4;
					playerX += Math.sqrt(2)/2;
					playerY -= Math.sqrt(2)/2;
                    if(collisionCheck()){
                      playerX -= Math.sqrt(2)/2;
					playerY += Math.sqrt(2)/2;  
                    }
                   
                }
                   
                
				else if (pressedKeys["KeyD"]) {
					playerFrameY = 5;
					playerX -= Math.sqrt(2)/2;
					playerY -= Math.sqrt(2)/2;
                    if(collisionCheck()){
                      playerX += Math.sqrt(2)/2;
					playerY += Math.sqrt(2)/2;  
                    }
                   
                }
                    
				
				else {
					playerFrameY = 0;
					playerY -= 1;
                    if(collisionCheck()){
					playerY += 1;  
                    }
                   
                }
                    
        }
            
			else if (pressedKeys["KeyA"]) {
				motion = true;
				playerFrameY = 2;
				playerX += 1;
                if(collisionCheck()){
                      playerX -= 1;
                    }
                   
            }
                
			
			else if (pressedKeys["KeyD"]) {
				motion = true;
				playerFrameY = 3;
				playerX -= 1;
                if(collisionCheck()){
                      playerX += 1;
                    }
			}
			else{
				motion = false;
			}
			if(pressedKeys["ShiftLeft"]){
				animationSpeed = 100;
			}
			else{
				animationSpeed = 150;
			}
		}
        
        function ai(){
               
        }
        
		setInterval(animate, animationSpeed);
		setInterval(draw, 5);

		window.onkeyup = function(e) { pressedKeys[e.code] = false; }
		window.onkeydown = function(e) { pressedKeys[e.code] = true; }
        
        
		
	</script>
</body>

</html>